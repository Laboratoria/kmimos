.container.pvp-7.ph-21
  .row.mv-56
    .col-md-2
    .col-md-7
      .info
        .user.border-bottom
          .user-card.user-card-round.size.xs.mb-21.row
            .user-pic.col-md-3
              = image_tag(@provider.avatar, class: 'avatar') if @provider.avatar?
              = image_tag('server_carnet.png', class: 'avatar') unless @provider.avatar?
              %center
                - val = Valuation.by_comments(@provider.id)
                - score = val.map{|val| val[1]}.reduce(:+).to_i / val.size.to_i rescue 0
                .ratingStars{score: score, readOnly: true}
            .user-info.col-md-9
              %h3.m-0.mb-7
                = "#{@provider.name} #{@provider.last_name_1}"
              %p
                %b Áreas donde puede recoger a tu perrito
              - @provider.locations.group_by(&:state_id).each do |k, state|
                %b.mb-7= state.first.state
                %br
                %p.mt-7.mb-7.text-gray= state.map(&:name).join(", ")
              - if current_user != nil
                .row
                  .col-md-5
                  .col-md-7
                    .favorite_form
                      - unless @provider.favorite?(current_user)
                        %a.btn.bordered-btn{href: "#{new_favorite_path}?provider_id=#{@provider.id}"}
                          %i.fa.fa-heart-o
                          %small Agregar a Favoritos 
      %h3.text-gray Detalles
      .row.details-profile.mt-35
        .col-md-3
          %p.label.text-center.text-gray
            -if @provider.property != nil
              Tipo de propiedad
              .icon= image_tag('detalles-casa.svg', height: '32px')
              %p.label-small
                %b= @provider.property
            - else
              Tipo de propiedad
              .icon= image_tag('detalles-casa.svg', height: '32px')
              %p.label-small
                %b= @provider.property
        .col-md-3
          %p.label.text-center.text-gray Tamaño aceptados
          .icon= image_tag('detalles-perro-grande.svg', height: '32px')
          %p.label-small
            %b="Perros #{@provider.sizes.map{|size| size.size_title}.join(', ')} "
        .col-md-3
          %p.label.text-center.text-gray Edades aceptadas
          .icon= image_tag('detalles-edad-perro-cachorro.svg', height: '32px')
          %p.label-small
            %b="#{@provider.ages.join(', ')} "
        .col-md-3
          %p.label.text-center.text-gray Años de experiencia
          .icon= image_tag('detalles-experiencia.svg', height: '32px')
          %p.label-small
            %b= "#{@provider.experiencia} "
      .border-bottom.mt-21
      -if @provider.provider_attachments.count > 0
        %h3.text-gray.mb-35.mt-49= "Fotos de #{@provider.name} #{@provider.last_name_1}"
        / Place somewhere in the <body> of your page
        .slider
          - @provider.provider_attachments.each do |p|
            .slide{style: "background: url('#{p.photo.url}')"} 
        .carousel
          - @provider.provider_attachments.each do |p|
            .slide-thumb{style: "background: url('#{p.photo.url}')"}
          
      %h3.text-gray.mb-35 Otros detalles
      .row.details-profile.pl-21
        .col-md-3
          %p.label.text-center.text-gray Tengo
          .icon= image_tag('otros-detalles-otros-perros.svg', height: '32px')
          %p.label-small
            %b= "#{@provider.number_of_pets} Perros en casa (#{@provider.own_sizes.map{|size| size.size_title}.join(', ')})"
        .col-md-3
          %p.label.text-center.text-gray Mi propiedad
          .icon= image_tag('otros-detalles-patio.svg', height: '32px')
          %p.label-small
            %b= @provider.has_yard ? "Tiene patio" : "No tiene patio"
        .col-md-3
          %p.label.text-center.text-gray Mi propiedad
          .icon= image_tag('otros-detalles-areas-verdes.svg', height: '32px')
          %p.label-small
            %b= @provider.has_green ? "Tiene areas Verdes" : "No tiene areas verdes"
        .col-md-3
          %p.label.text-center.text-gray # Perros aceptados
          .icon= image_tag('otros-detalles-cantidad-perros.svg', height: '32px')
          %p.label-small
            %b="#{@provider.pets_allowed.to_i}"
      .row.details-profile.pl-21
        - if !(@provider.only_sterilizated)
          .col-md-3
            %p.label.text-center.text-gray Esterilizacón
            .icon= image_tag('perro_esterilizado.svg', height: '32px')
            %p.label-small 
              %b Solo acepta perros esterilizados
      .Comportamientos
        %h3.text-gray Comportamientos de perros aceptados
        .row.comp
          - @provider.accepted_behaviors.each do |behavior|
            = image_tag('huella_comportamientos.svg')
            = behavior
      .descripcion-perfil.border-top
        %h3.text-gray="Sobre #{@provider.name} :"
        %p= @provider.description

      .ubicacion
        %h3.text-gray Ubicación
        .row
          .col-md-5
            %h4.text-secondary Areas donde puede recoger a tu perrito
            - @provider.locations.group_by(&:state_id).each do |k, state|
              %h4.mb-14.mt-21.pb-7.border-bottom= state.first.state
              - state.each do |city|
                .city-span.mt-7.mb-7
                  = image_tag('icono-distritos.svg')
                  %span.text-third= city
                  %br
          .col-md-7
            #map{style: "width: 100%; height: 400px;", latitude: @provider.latitude, longitude: @provider.longitude, zoom: "14"}
            .circle{latitude: @provider.latitude, longitude: @provider.longitude, radio: '800'}

      .comentarios#comentarios_kmimos
        %h3.text-gray Experiencias Kmimos
        #comments-div
          = render partial: 'layouts/partial/comments', locals: {provider: @provider}

    .col-md-3
      = simple_form_for Booking.new, :method => 'GET', :url => new_booking_path do |f|
        = f.input :provider_id, as: :hidden, input_html: {value: @provider.id}
        .content-article.mt-14.mb-28.m-21
          .border-bottom.text-left.pl-21
            %p.light.mb-0.text-gray.text-small Desde
            %h4.m-7.price
              = 1.2*(@provider.rates.minimum(:price)) rescue 0
              = current_country.currency
            %h5.light.mt-0.text-gray.text-small por noche
            .col-md-12.border-top.border-bottom.pt-7.pb-7  
              %p Tarifas por tamaños
              - rates = Array.new
              - @provider.rates.order(size_id: :asc).uniq.each do |a|
                - if !rates.include?(a.size.size_title)
                  %p{style:"font-size:11px"}="#{a.size.size_title} :  #{1.2*(a.price) rescue 0}  #{current_country.currency}"
                - rates << a.size.size_title
            =f.submit "Reservar".html_safe, :class => "mt-14 mb-21 btn btn-primary btn-small btn-fold" #,  :onClick=>"_gaq.push(['_trackEvent', 'Proveedores', 'Reservar', 'provider_#{@provider.id.to_s}']);"
            %br/
            = link_to "Conocer cuidador".html_safe, new_meeting_path(:provider_id => @provider.id), :class => "text-secondary btn btn-fold", :style => "border-color: #1DBA9A; padding: 10px 7px;",  :onClick=>"_gaq.push(['_trackEvent', 'Proveedores', 'Conocer', 'provider_#{@provider.id.to_s}']);"
            %br
            %br
            %p
              %b Horario Recomendado  
            %p
              %b Check in:
              = @provider.check_in.strftime("%H:%M") rescue ""
            %p
              %b Check out:
              = @provider.check_out.strftime("%H:%M") rescue ""

        .content-detalles.mt-14-mb-28.m-21.pb-14
          .border-bottom.text-left.pl-21
            %h4.text-gray.mv-14.border-bottom
              Servicios Adicionales
            %p Elige el servicio que deseas para tu mascota. Si solo quieres contratar un servicio y no una estadía, entonces selecciona el servicio y dale Contratar. 
            - @provider.services.order('id').uniq.each do |service|
              %input.mt-21{value: service.id}(type="checkbox" name="services[]")
                %small
                  #{service}
                  %i{style: 'color: #a7a279'}
                    %br
                    desde
                    #{AdditionalService.get_min_rates_for(@provider.id, service.id)}
              %br
            =f.submit "Contratar".html_safe, :class => "mt-14 mb-21 btn btn-primary btn-small btn-fold" #,  :onClick=>"_gaq.push(['_trackEvent', 'Proveedores', 'Reservar', 'provider_#{@provider.id.to_s}']);"
        .content-detalles.mt-14-mb-28.m-21.pb-14
          .border-bottom.text-left.pl-21
            %h4.text-gray.mv-14="#{@provider.comments.count} Evaluaciones"
          .text-left.ph-21
            -Valuation.by_comments(@provider.id).each do |valuation, value|
              %h5= valuation
              .ratingStars.pl-14.mt-7{score: value.to_i, readOnly: true}
            %br


:javascript
  
    // The slider being synced must be initialized first
    $('.carousel').slick({
      slidesToShow: 3,
      slidesToScroll: 1,
      asNavFor: '.slider',
      dots: true,
      centerMode: true,
      focusOnSelect: true,
      autoplay: true,
      autoplaySpeed: 2000
    });

    $('.slider').slick({
      slidesToShow: 1,
      slidesToScroll: 1,
      asNavFor: '.carousel',
      fade: true,
      arrows: false
    });

  providerMap = initMap('providerMap', 'map');

  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = 'kmimos';

  
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
